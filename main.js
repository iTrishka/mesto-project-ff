(()=>{"use strict";var e=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),e.addEventListener("click",n)},t=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n),e.removeEventListener("click",n)},n=function(e){var n=document.querySelector(".popup_is-opened"),o=n.querySelector(".popup__close"),r=n.querySelector(".popup__content");("keydown"===e.type&&"Escape"===e.key||"click"===e.type&&(e.target===o||!r.contains(e.target)))&&t(n)},o=document.querySelector(".profile__title"),r=document.querySelector(".profile__description"),c=document.querySelector(".profile__image"),i=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__edit-button"),u=document.querySelector(".places__list"),l=document.querySelector("#card-template").content,s=document.querySelector(".popup_type_image"),d=s.querySelector(".popup__image"),p=s.querySelector(".popup__caption"),f=document.querySelector(".popup_type_new-card"),_=document.forms["new-place"],m=_.elements["place-name"],v=_.elements.link,y=document.querySelector(".popup_type_edit"),S=document.forms["edit-profile"],h=S.elements.name,k=S.elements.description,E=document.querySelector(".popup_type_edit-avatar"),q=document.forms["edit-avatar"],L=q.elements.link,b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},g="Сохранить",C="Сохранение...",T="Что-то пошло не так...",P={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"a040f8ad-2e23-4247-b284-1555f9f98cf2","Content-Type":"application/json"}},x=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"GET"===t||"DELETE"===t||"PUT"===t||"HEAD"===t?fetch("".concat(P.baseUrl,"/").concat(e),{method:t,headers:P.headers}).then((function(e){return x(e)})).catch((function(e){console.log(e)})):"POST"===t||"PATCH"===t?fetch("".concat(P.baseUrl,"/").concat(e),{method:t,headers:P.headers,body:JSON.stringify(n)}).then((function(e){return x(e)})):void 0},w=function(e){return A("cards/".concat(e),"DELETE")},D=function(e,t,n,o,r){var c=l.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__delete-button"),a=c.querySelector(".card__like-button"),u=c.querySelector(".card__like-counter"),s=c.querySelector(".card__image"),d=c.querySelector(".card__title");return c.dataset.id=e._id,d.textContent=e.name,s.src=e.link,s.alt=e.name,U(u,e.likes),e.likes.some((function(e){return e._id===r}))&&a.classList.add("card__like-button_is-active"),M(r,e.owner._id,i),i.addEventListener("click",(function(n){n.stopPropagation(),t(e._id).then((function(e){c.remove()})).catch((function(e){console.log(e),formatting}))})),a.addEventListener("click",(function(t){n(r,e,a,u),t.stopPropagation()})),s.addEventListener("click",(function(){return o(e)})),c},B=function(t){d.src=t.link,d.alt=t.name,p.textContent=t.name,e(s)},U=function(e,t){e.textContent=t.length},H=function(e,t,n,o){var r;t.likes.some((function(t){return t._id===e}))?(r=t._id,A("cards/likes/".concat(r),"DELETE")).then((function(e){t.likes=e.likes,U(o,e.likes),n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return A("cards/likes/".concat(e),"PUT")}(t._id).then((function(e){t.likes=e.likes,U(o,e.likes),n.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))},M=function(e,t,n){e!==t&&n.classList.add("card__delete-button_hidden")},j=function(e,t,n,o){var r=t.querySelector(".".concat(n.name,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)},O=function(e,t,n){var o=t.querySelector(".".concat(n.name,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""},G=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.disabled=!1):(n.classList.add(e.inactiveButtonClass),n.disabled=!0)},N=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){O(t,e,n)})),G(t,n,o)},z="",I=function(e){o.textContent=e.name,r.textContent=e.about,c.style.backgroundImage="url(".concat(e.avatar,")")};function J(e,t){e.querySelector(".popup__button").textContent=t}Promise.all([A("cards"),A("users/me")]).then((function(e){z=e[1]._id,function(e,t){e.forEach((function(e){u.append(D(e,w,H,B,t))}))}(e[0],e[1]._id),I(e[1])})).catch((function(e){console.log(e)})),i.addEventListener("click",(function(){N(f,b),e(f)})),_.addEventListener("submit",(function(e){e.preventDefault();var n,o={name:m.value,link:v.value,owner:{_id:z}};J(_,C),(n=o,A("cards","POST",{name:n.name,link:n.link})).then((function(e){u.prepend(D(e,w,H,B,z)),_.reset(),t(f),J(_,g)})).catch((function(e){J(_,T),console.log(e)}))})),a.addEventListener("click",(function(){h.value=o.textContent,k.value=r.textContent,N(S,b),e(y)})),S.addEventListener("submit",(function(e){var n,o;e.preventDefault(),J(S,C),(n=h.value,o=k.value,A("users/me","PATCH",{name:n,about:o})).then((function(e){I(e),t(y),J(S,g)})).catch((function(e){console.log(e),J(S,T)}))})),c.addEventListener("click",(function(){N(E,b),e(E)})),q.addEventListener("submit",(function(e){var n;e.preventDefault(),J(q,C),(n=L.value,A("users/me/avatar","PATCH",{avatar:n})).then((function(e){I(e),q.reset(),t(E),J(q,g)})).catch((function(e){J(q,T),console.log(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?j(e,t,n,n.dataset.errorMessage):n.validity.patternMismatch||n.validity.valid?O(e,t,n):(console.log("enter2"),j(e,t,n,n.validationMessage))}(e,t,r),G(e,n,o)}))}))}))}(b)})();