(()=>{"use strict";var e,t=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),e.addEventListener("click",o)},n=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),e.removeEventListener("click",o)},o=function(e){var t=document.querySelector(".popup_is-opened"),o=(t.querySelector(".popup__form"),t.querySelector(".popup__close")),r=t.querySelector(".popup__content");"click"!==e.type||e.target!==o&&r.contains(e.target)?"keydown"===e.type&&"Escape"===e.key&&n(t):n(t)},r=document.querySelector(".profile__title"),c=document.querySelector(".profile__description"),i=document.querySelector(".profile__image"),u=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__edit-button"),l=document.querySelector(".places__list"),s=document.querySelector("#card-template").content,d=document.querySelector(".popup_type_image"),p=d.querySelector(".popup__image"),_=d.querySelector(".popup__caption"),f=document.querySelector(".popup_type_new-card"),m=document.forms["new-place"],v=m.elements["place-name"],y=m.elements.link,S=document.querySelector(".popup_type_edit"),h=document.forms["edit-profile"],k=h.elements.name,b=h.elements.description,E=document.querySelector(".popup_type_edit-avatar"),q=document.forms["edit-avatar"],L=q.elements.link,g={inputSelector:".popup__input",submitButtonSelector:".popup__button"},C="Сохранить",T="Сохранение...",P="Что-то пошло не так...",x={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"a040f8ad-2e23-4247-b284-1555f9f98cf2","Content-Type":"application/json"}},A=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"GET"===t||"DELETE"===t||"PUT"===t||"HEAD"===t?fetch("".concat(x.baseUrl,"/").concat(e),{method:t,headers:x.headers}).then((function(e){return A(e)})).catch((function(e){console.log(e)})):"POST"===t||"PATCH"===t?fetch("".concat(x.baseUrl,"/").concat(e),{method:t,headers:x.headers,body:JSON.stringify(n)}).then((function(e){return A(e)})).catch((function(e){console.log(e)})):void 0},D=function(){return w("users/me")},B=function(e){return w("cards/".concat(e),"DELETE")},U=function(e,t,n,o,r){var c=s.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),a=c.querySelector(".card__like-counter"),l=c.querySelector(".card__image"),d=c.querySelector(".card__title");return c.dataset.id=e._id,d.textContent=e.name,l.src=e.link,l.alt=e.name,M(a,e.likes),e.likes.some((function(e){return e._id===r}))&&u.classList.add("card__like-button_is-active"),O(r,e.owner._id,i),i.addEventListener("click",(function(n){n.stopPropagation(),t(e._id).then((function(e){c.remove()})).catch((function(e){console.log(e),formatting}))})),u.addEventListener("click",(function(t){n(r,e,u,a),t.stopPropagation()})),l.addEventListener("click",(function(){return o(e)})),c},H=function(e){p.src=e.link,p.alt=e.name,_.textContent=e.name,t(d)},M=function(e,t){e.textContent=t.length},j=function(e,t,n,o){var r;t.likes.some((function(t){return t._id===e}))?(r=t._id,w("cards/likes/".concat(r),"DELETE")).then((function(e){t.likes=e.likes,M(o,e.likes),n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return w("cards/likes/".concat(e),"PUT")}(t._id).then((function(e){t.likes=e.likes,M(o,e.likes),n.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))},O=function(e,t,n){e!==t&&n.classList.add("card__delete-button_hidden")},G=function(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input-error_active")},N=function(e,t){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""},z=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("button_inactive"),t.disabled=!1):(t.classList.add("button_inactive"),t.disabled=!0)},I=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(t){N(e,t)})),z(n,o)},J="",F=function(e){r.textContent=e.name,c.textContent=e.about,i.style.backgroundImage="url(".concat(e.avatar,")")};function K(e,t){e.querySelector(".popup__button").textContent=t}Promise.all([w("cards"),D()]).then((function(e){J=e[1]._id,function(e,t){e.forEach((function(e){l.append(U(e,B,j,H,t))}))}(e[0],e[1]._id),F(e[1])})).catch((function(e){console.log(e)})),u.addEventListener("click",(function(){I(f,g),t(f)})),m.addEventListener("submit",(function(e){e.preventDefault();var t,o={name:v.value,link:y.value,owner:{_id:J}};K(m,T),(t=o,w("cards","POST",{name:t.name,link:t.link})).then((function(e){l.prepend(U(e,B,j,H,J)),m.reset(),n(f),K(m,C)})).catch((function(e){K(m,P),console.log(e)}))})),a.addEventListener("click",(function(){k.value=r.textContent,b.value=c.textContent,I(h,g),t(S)})),h.addEventListener("submit",(function(e){var t,o;e.preventDefault(),K(h,T),(t=k.value,o=b.value,w("users/me","PATCH",{name:t,about:o})).then((function(e){return D()})).then((function(e){F(e),n(S),K(h,C)})).catch((function(e){console.log(e),K(h,P)}))})),i.addEventListener("click",(function(){I(E,g),t(E)})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),K(q,T),(t=L.value,w("users/me/avatar","PATCH",{avatar:t})).then((function(e){F(e),q.reset(),n(E),K(q,C)})).catch((function(e){K(q,P),console.log(e)}))})),e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?G(e,t,t.dataset.errorMessage):t.validity.patternMismatch||t.validity.valid?N(e,t):G(e,t,t.validationMessage)}(t,e),z(n,o)}))}))}))})();